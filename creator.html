<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LineBlox - NODE CREATOR [1.1]</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/editor.css">
</head>
<body>
    <div id="topbar">
        <button onclick="document.getElementById('codeContainer').textContent=LBInst.GenerateCode();
            document.getElementById('code').hidden = false;
            Prism.highlightElement(document.getElementById('codeContainer'));">View Code</button>
        <a href="creator-docs.html" target="_blank"><button>Documentation</button></a> |
        <button onclick="download()">Save workspace (file)</button> |
        Load File: <input type="file" id="fileInput" accept=".lbcnode"> |
        NOTICE: This editor contains some (weird) bugs with output nodes (e.g. "String").
    </div>

    <div id="code" hidden>
        <center>
            <button onclick="document.getElementById('code').hidden = true">Hide</button>
        </center>
        <hr>
        <div id="internalCode">
            <pre class="line-numbers"><code id="codeContainer" class="language-javascript"></code></pre>
        </div>
    </div>
    <div id="nodeDrawer" style="position: absolute; right: 0; top: 40px;
        width: 200px; height: calc(100% - 40px);">
        <canvas id="nodeDraw" style="position: absolute; height: 200px; width: 200px;"></canvas>
    </div>

    <script src="js/editorConfig.js"></script>
    <script src="js/editor.js"></script>
    <script src="js/toolbox.js"></script>
    <script src="js/scrollbar.js"></script>
    <script src="js/node.js"></script>
    <script src="js/nodeHelper.js"></script>
    <script src="js/nodes/main.js"></script>
    <script src="js/nodes/creator.js"></script>

    <script src="otherJS/nodeDrawer.js"></script>
    <script>
        const _tb = [
            {
                category: "Main",
                color: "green",
                blocks: [
                    "__start__"
                ]
            },
            {
                category: "Logic",
                color: "rgba(0, 144, 180, 1)",
                blocks: [
                    "logic_bool"
                ]
            },
            {
                category: "Math",
                color: "rgba(0, 72, 180, 1)",
                blocks: [
                    "math_num"
                ]
            },
            {
                category: "String",
                color: "rgba(207, 125, 2, 1)",
                blocks: [
                    "string_str"
                ]
            },
            {
                category: "Arrays",
                color: "rgba(109, 0, 182, 1)",
                blocks: [
                    "array_create"
                ]
            },
            {
                category: "Node",
                color: "rgba(255, 0, 0, 1)",
                blocks: [
                    "node_main", "node_rgb", "node_ioc", "node_ioh", "node_type_0", "node_type_1"
                ]
            }
        ];

        const config = new LineBloxConfig();
        config.offsets.left = 0;
        config.offsets.right = 200;
        config.offsets.top = 40;

        config.toolbox.tbNodes = _tb;
        config.toolbox.toolboxW = 300;

        const LBInst = new LineBlox(null, config);
        LBInst.updateCallback = () => draw();
        (async () => {
            await LBInst.EnablePluginSupport("js/nodes/plugins/", "pluginDefs.jsonc");
        });
    </script>

    <!-- syntax highlighting -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>

    <!-- syntax: row numbers -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script>

    <!-- syntax: copy to clipboard -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/toolbar/prism-toolbar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>

    <script>
        function download(){
            const code = LBInst.GetWorkspace();
            const blob = new Blob([JSON.stringify(code)], {type: 'text/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'linebloxNodes.lbcnode';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        document.getElementById("fileInput").addEventListener("change", async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const text = await file.text();
            const data = JSON.parse(text);

            LBInst.SetWorkspace(data);
        });
    </script>
</body>
</html>
